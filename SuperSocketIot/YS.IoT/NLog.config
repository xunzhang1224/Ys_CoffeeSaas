<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

      autoReload="true"
      throwExceptions="false"
      internalLogLevel="Off" internalLogFile="logs/internal-nlog.txt">

	<!-- optional, add some variables v
  https://github.com/nlog/NLog/wiki/Configuration-file#variables
  -->
	<variable name="myvar" value="myvalue" />

	<!--
  See https://github.com/nlog/nlog/wiki/Configuration-file
  for information on customizing logging rules and outputs.
   -->
	<targets async="true">
		<!--
    add your targets here
    See https://github.com/nlog/NLog/wiki/Targets for possible targets.
    See https://github.com/nlog/NLog/wiki/Layout-Renderers for the possible layout renderers.
    -->
<target name="console" xsi:type="ColoredConsole" layout="${longdate}-|-${uppercase:${level}}-|-${callsite:cleanNamesOfAsyncContinuations=true:cleanNamesOfAnonymousDelegates=true}-|-${message}" >
	<!-- 根据日志级别设置颜色 -->
	<highlight-row condition="level == LogLevel.Trace" foregroundColor="Gray" />
	<highlight-row condition="level == LogLevel.Debug" foregroundColor="DarkGray" />
	<highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
	<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
	<highlight-row condition="level == 'Error'" foregroundColor="Red" backgroundColor="#FF9999" />
	<!-- 浅红 -->
	<highlight-row condition="level == 'Fatal'" foregroundColor="White" backgroundColor="#FF9999" />
	<!-- 浅红 -->
</target>
<target xsi:type="File" name="ownFile-web" fileName="logs/${date:format=yyyyMMdd}.${level}.log"
		archiveAboveSize="10485760"
		maxArchiveFiles="50"
		encoding="UTF-8"
		archiveEvery="Day">
	<layout xsi:type="JsonLayout" includeAllProperties="true" excludeProperties="Comma-separated list (string)">
		<attribute name="Longdate" layout="${longdate}" />
		<attribute name="Level" layout="${level:upperCase=true}" />
		<attribute name="Logger" layout="${logger}" />
		<attribute name="LocalHost" layout="${gdc:item=LocalHost" />
		<attribute name="Callsite" layout="${callsite:cleanNamesOfAsyncContinuations=true:cleanNamesOfAnonymousDelegates=true}" />
		<attribute name="TraceId" layout="${aspnet-TraceIdentifier}" />
		<attribute name="Host" layout="${aspnet-request-host}" />
		<attribute name="Application" layout="${aspnet-application}" />
		<attribute name="Info" layout="${message}" escapeUnicode="false" />
		<attribute name="Excetption" layout="${exception:format=ToString,StackTrace}" escapeUnicode="false" />
	</layout>
</target>
<target xsi:type="Null" name="blackhole" />
<target name="jsonFile" xsi:type="File" fileName="logs/${date:format=yyyyMMdd}.${level}.log" archiveAboveSize="10485760" maxArchiveFiles="30"
 encoding="UTF-8" archiveEvery="Day">
	<layout xsi:type="JsonLayout" includeAllProperties="true" excludeProperties="Comma-separated list (string)">
		<attribute name="Longdate" layout="${longdate}" />
		<attribute name="HostName" layout="${event-properties:JoviCommandContext:objectPath=HostName}" />
		<attribute name="Level" layout="${level:upperCase=true}" />
		<attribute name="ClientId" layout="${event-properties:JoviCommandContext:objectPath=ClientId}" />
		<attribute name="Id" layout="${event-properties:JoviCommandContext:objectPath=Id}" />
		<attribute name="InstanceId" layout="${event-properties:JoviCommandContext:objectPath=InstanceId}" />
		<attribute name="Topic" layout="${event-properties:JoviCommandContext:objectPath=Topic}" />
		<attribute name="SecondTopic" layout="${event-properties:JoviCommandContext:objectPath=SecondTopic}" />
		<attribute name="Body" layout="${event-properties:JoviCommandContext:objectPath=Body}" escapeUnicode="false" />
		<attribute name="PublishTime" layout="${event-properties:JoviCommandContext:objectPath=PublishTime}" />
		<attribute name="FirstConsumeTime" layout="${event-properties:JoviCommandContext:objectPath=FirstConsumeTime}" />
		<attribute name="NextConsumeTime" layout="${event-properties:JoviCommandContext:objectPath=NextConsumeTime}" />
		<attribute name="ConsumedTimes" layout="${event-properties:JoviCommandContext:objectPath=ConsumedTimes}" />
		<attribute name="BeginTime" layout="${event-properties:JoviCommandContext:objectPath=BeginTime}" />
		<attribute name="EndTime" layout="${event-properties:JoviCommandContext:objectPath=EndTime}" />
		<attribute name="Exception" layout="${event-properties:JoviCommandContext:objectPath=Exception}" />
		<attribute name="Channel" layout="${event-properties:JoviCommandContext:objectPath=Channel}" />
		<attribute name="Mid" layout="${event-properties:JoviCommandContext:objectPath=Mid}" />
		<attribute name="ResponseId" layout="${event-properties:JoviCommandContext:objectPath=ResponseId}" />
		<attribute name="ResponseBody" layout="${event-properties:JoviCommandContext:objectPath=ResponseBody}" />
	</layout>
</target>
	</targets>
	<rules>
		<logger name="Microsoft.*" minlevel="Debug" writeTo="blackhole" final="true" />
		<logger name="MagicOnion*" minlevel="Debug" writeTo="blackhole" final="true" />
		<logger name="Grpc.AspNetCore.Server*" minlevel="Debug" writeTo="blackhole" final="true" />
		<!--<logger name="*" minlevel="Info" writeTo="ownFile-web,ownLog-tcp-Info,console" />-->
		<logger name="CommandContext" minlevel="Warning" maxlevel="Warning" writeTo="jsonFile" final="true" />
		<logger name="*" minlevel="Debug" writeTo="ownFile-web,console" final="true" />
		<!-- add your logging rules here -->
		<!--
    Write all events with minimal level of Debug (So Debug, Info, Warn, Error and Fatal, but not Trace)  to "f"
    <logger name="*" minlevel="Debug" writeTo="f" />
    -->
	</rules>
</nlog>